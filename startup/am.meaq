[0;31mSignature:[0m [0msam[0m[0;34m.[0m[0malign[0m[0;34m([0m[0mstep[0m[0;34m=[0m[0;36m0[0m[0;34m,[0m [0mreflection_angle[0m[0;34m=[0m[0;36m0.08[0m[0;34m,[0m [0mverbosity[0m[0;34m=[0m[0;36m3[0m[0;34m)[0m[0;34m[0m[0m
[0;31mSource:[0m   
    [0;32mdef[0m [0malign[0m[0;34m([0m[0mself[0m[0;34m,[0m [0mstep[0m[0;34m=[0m[0;36m0[0m[0;34m,[0m [0mreflection_angle[0m[0;34m=[0m[0;36m0.08[0m[0;34m,[0m [0mverbosity[0m[0;34m=[0m[0;36m3[0m[0;34m)[0m[0;34m:[0m[0;34m[0m
[0;34m[0m        [0;34m'''Align the sample with respect to the beam. GISAXS alignment involves[0m
[0;34m        vertical translation to the beam center, and rocking theta to get the[0m
[0;34m        sample plane parralel to the beam. Finally, the angle is re-optimized[0m
[0;34m        in reflection mode.[0m
[0;34m        [0m
[0;34m        The 'step' argument can optionally be given to jump to a particular[0m
[0;34m        step in the sequence.'''[0m[0;34m[0m
[0;34m[0m[0;34m[0m
[0;34m[0m        [0;32mif[0m [0mverbosity[0m[0;34m>=[0m[0;36m4[0m[0;34m:[0m[0;34m[0m
[0;34m[0m            [0mprint[0m[0;34m([0m[0;34m'  Aligning {}'[0m[0;34m.[0m[0mformat[0m[0;34m([0m[0mself[0m[0;34m.[0m[0mname[0m[0;34m)[0m[0;34m)[0m[0;34m[0m
[0;34m[0m        [0;34m[0m
[0;34m[0m        [0;32mif[0m [0mstep[0m[0;34m<=[0m[0;36m0[0m[0;34m:[0m[0;34m[0m
[0;34m[0m            [0;31m# Prepare for alignment[0m[0;34m[0m
[0;34m[0m            [0;34m[0m
[0;34m[0m            [0;32mif[0m [0mRE[0m[0;34m.[0m[0mstate[0m[0;34m!=[0m[0;34m'idle'[0m[0;34m:[0m[0;34m[0m
[0;34m[0m                [0mRE[0m[0;34m.[0m[0mabort[0m[0;34m([0m[0;34m)[0m[0;34m[0m
[0;34m[0m                [0;34m[0m
[0;34m[0m            [0;32mif[0m [0mget_beamline[0m[0;34m([0m[0;34m)[0m[0;34m.[0m[0mcurrent_mode[0m[0;34m!=[0m[0;34m'alignment'[0m[0;34m:[0m[0;34m[0m
[0;34m[0m                [0;32mif[0m [0mverbosity[0m[0;34m>=[0m[0;36m2[0m[0;34m:[0m[0;34m[0m
[0;34m[0m                    [0mprint[0m[0;34m([0m[0;34m"WARNING: Beamline is not in alignment mode (mode is '{}')"[0m[0;34m.[0m[0mformat[0m[0;34m([0m[0mget_beamline[0m[0;34m([0m[0;34m)[0m[0;34m.[0m[0mcurrent_mode[0m[0;34m)[0m[0;34m)[0m[0;34m[0m
[0;34m[0m                [0;31m#get_beamline().modeAlignment()[0m[0;34m[0m
[0;34m[0m                [0;34m[0m
[0;34m[0m                [0;34m[0m
[0;34m[0m            [0mget_beamline[0m[0;34m([0m[0;34m)[0m[0;34m.[0m[0msetDirectBeamROI[0m[0;34m([0m[0;34m)[0m[0;34m[0m
[0;34m[0m            [0;34m[0m
[0;34m[0m            [0mbeam[0m[0;34m.[0m[0mon[0m[0;34m([0m[0;34m)[0m[0;34m[0m
[0;34m[0m[0;34m[0m
[0;34m[0m        [0;34m[0m
[0;34m[0m        [0;32mif[0m [0mstep[0m[0;34m<=[0m[0;36m2[0m[0;34m:[0m[0;34m[0m
[0;34m[0m            [0;32mif[0m [0mverbosity[0m[0;34m>=[0m[0;36m4[0m[0;34m:[0m[0;34m[0m
[0;34m[0m                [0mprint[0m[0;34m([0m[0;34m'    align: searching'[0m[0;34m)[0m[0;34m[0m
[0;34m[0m                [0;34m[0m
[0;34m[0m            [0;31m# Estimate full-beam intensity[0m[0;34m[0m
[0;34m[0m            [0mvalue[0m [0;34m=[0m [0;32mNone[0m[0;34m[0m
[0;34m[0m            [0;32mif[0m [0;32mTrue[0m[0;34m:[0m[0;34m[0m
[0;34m[0m                [0;31m# You can eliminate this, in which case RE.md['beam_intensity_expected'] is used by default[0m[0;34m[0m
[0;34m[0m                [0mself[0m[0;34m.[0m[0myr[0m[0;34m([0m[0;34m-[0m[0;36m2[0m[0;34m)[0m[0;34m[0m
[0;34m[0m                [0;31m#detector = gs.DETS[0][0m[0;34m[0m
[0;34m[0m                [0mdetector[0m [0;34m=[0m [0mget_beamline[0m[0;34m([0m[0;34m)[0m[0;34m.[0m[0mdetector[0m[0;34m[[0m[0;36m0[0m[0;34m][0m[0;34m[0m
[0;34m[0m                [0mvalue_name[0m [0;34m=[0m [0mget_beamline[0m[0;34m([0m[0;34m)[0m[0;34m.[0m[0mTABLE_COLS[0m[0;34m[[0m[0;36m0[0m[0;34m][0m[0;34m[0m
[0;34m[0m                [0mRE[0m[0;34m([0m[0mcount[0m[0;34m([0m[0;34m[[0m[0mdetector[0m[0;34m][0m[0;34m)[0m[0;34m)[0m[0;34m[0m
[0;34m[0m                [0mvalue[0m [0;34m=[0m [0mdetector[0m[0;34m.[0m[0mread[0m[0;34m([0m[0;34m)[0m[0;34m[[0m[0mvalue_name[0m[0;34m][0m[0;34m[[0m[0;34m'value'[0m[0;34m][0m[0;34m[0m
[0;34m[0m                [0mself[0m[0;34m.[0m[0myr[0m[0;34m([0m[0;34m+[0m[0;36m2[0m[0;34m)[0m[0;34m[0m
[0;34m[0m            [0;34m[0m
[0;34m[0m            [0;32mif[0m [0;34m'beam_intensity_expected'[0m [0;32min[0m [0mRE[0m[0;34m.[0m[0mmd[0m [0;32mand[0m [0mvalue[0m[0;34m<[0m[0mRE[0m[0;34m.[0m[0mmd[0m[0;34m[[0m[0;34m'beam_intensity_expected'[0m[0;34m][0m[0;34m*[0m[0;36m0.75[0m[0;34m:[0m[0;34m[0m
[0;34m[0m                [0mprint[0m[0;34m([0m[0;34m'WARNING: Direct beam intensity ({}) lower than it should be ({})'[0m[0;34m.[0m[0mformat[0m[0;34m([0m[0mvalue[0m[0;34m,[0m [0mRE[0m[0;34m.[0m[0mmd[0m[0;34m[[0m[0;34m'beam_intensity_expected'[0m[0;34m][0m[0;34m)[0m[0;34m)[0m[0;34m[0m
[0;34m[0m                [0;34m[0m
[0;34m[0m            [0;31m# Find the step-edge[0m[0;34m[0m
[0;34m[0m            [0mself[0m[0;34m.[0m[0mysearch[0m[0;34m([0m[0mstep_size[0m[0;34m=[0m[0;36m0.5[0m[0;34m,[0m [0mmin_step[0m[0;34m=[0m[0;36m0.005[0m[0;34m,[0m [0mintensity[0m[0;34m=[0m[0mvalue[0m[0;34m,[0m [0mtarget[0m[0;34m=[0m[0;36m0.5[0m[0;34m,[0m [0mverbosity[0m[0;34m=[0m[0mverbosity[0m[0;34m,[0m [0mpolarity[0m[0;34m=[0m[0;34m-[0m[0;36m1[0m[0;34m)[0m[0;34m[0m
[0;34m[0m            [0;34m[0m
[0;34m[0m            [0;31m# Find the peak[0m[0;34m[0m
[0;34m[0m            [0mself[0m[0;34m.[0m[0mthsearch[0m[0;34m([0m[0mstep_size[0m[0;34m=[0m[0;36m0.4[0m[0;34m,[0m [0mmin_step[0m[0;34m=[0m[0;36m0.01[0m[0;34m,[0m [0mtarget[0m[0;34m=[0m[0;34m'max'[0m[0;34m,[0m [0mverbosity[0m[0;34m=[0m[0mverbosity[0m[0;34m)[0m[0;34m[0m
[0;34m[0m        [0;34m[0m
[0;34m[0m        [0;34m[0m
[0;34m[0m        [0;32mif[0m [0mstep[0m[0;34m<=[0m[0;36m4[0m[0;34m:[0m[0;34m[0m
[0;34m[0m            [0;32mif[0m [0mverbosity[0m[0;34m>=[0m[0;36m4[0m[0;34m:[0m[0;34m[0m
[0;34m[0m                [0mprint[0m[0;34m([0m[0;34m'    align: fitting'[0m[0;34m)[0m[0;34m[0m
[0;34m[0m            [0;34m[0m
[0;34m[0m            [0mfit_scan[0m[0;34m([0m[0msmy[0m[0;34m,[0m [0;36m1.2[0m[0;34m,[0m [0;36m21[0m[0;34m,[0m [0mfit[0m[0;34m=[0m[0;34m'HMi'[0m[0;34m)[0m[0;34m[0m
[0;34m[0m            [0;31m#time.sleep(2)[0m[0;34m[0m
[0;34m[0m            [0mfit_scan[0m[0;34m([0m[0msth[0m[0;34m,[0m [0;36m1.5[0m[0;34m,[0m [0;36m21[0m[0;34m,[0m [0mfit[0m[0;34m=[0m[0;34m'max'[0m[0;34m)[0m[0;34m[0m
[0;34m[0m            [0;31m#time.sleep(2)            [0m[0;34m[0m
[0;34m[0m            [0;34m[0m
[0;34m[0m        [0;31m#if step<=5:[0m[0;34m[0m
[0;34m[0m        [0;31m#    #fit_scan(smy, 0.6, 17, fit='sigmoid_r')[0m[0;34m[0m
[0;34m[0m        [0;31m#    fit_edge(smy, 0.6, 17)[0m[0;34m[0m
[0;34m[0m        [0;31m#    fit_scan(sth, 1.2, 21, fit='max')[0m[0;34m[0m
[0;34m[0m[0;34m[0m
[0;34m[0m[0;34m[0m
[0;34m[0m        [0;32mif[0m [0mstep[0m[0;34m<=[0m[0;36m8[0m[0;34m:[0m[0;34m[0m
[0;34m[0m            [0;31m#fit_scan(smy, 0.3, 21, fit='sigmoid_r')[0m[0;34m[0m
[0;34m[0m            [0;34m[0m
[0;34m[0m            [0mfit_edge[0m[0;34m([0m[0msmy[0m[0;34m,[0m [0;36m0.6[0m[0;34m,[0m [0;36m21[0m[0;34m)[0m[0;34m[0m
[0;34m[0m            [0;31m#time.sleep(2)[0m[0;34m[0m
[0;34m[0m            [0;31m#fit_edge(smy, 0.4, 21)[0m[0;34m[0m
[0;34m[0m            [0mfit_scan[0m[0;34m([0m[0msth[0m[0;34m,[0m [0;36m0.8[0m[0;34m,[0m [0;36m21[0m[0;34m,[0m [0mfit[0m[0;34m=[0m[0;34m'COM'[0m[0;34m)[0m[0;34m[0m
[0;34m[0m            [0;31m#time.sleep(2)            [0m[0;34m[0m
[0;34m[0m            [0mself[0m[0;34m.[0m[0msetOrigin[0m[0;34m([0m[0;34m[[0m[0;34m'y'[0m[0;34m,[0m [0;34m'th'[0m[0;34m][0m[0;34m)[0m[0;34m[0m
[0;34m[0m        [0;34m[0m
[0;34m[0m        [0;34m[0m
[0;34m[0m        [0;32mif[0m [0mstep[0m[0;34m<=[0m[0;36m9[0m [0;32mand[0m [0mreflection_angle[0m [0;32mis[0m [0;32mnot[0m [0;32mNone[0m[0;34m:[0m[0;34m[0m
[0;34m[0m            [0;31m# Final alignment using reflected beam[0m[0;34m[0m
[0;34m[0m            [0;32mif[0m [0mverbosity[0m[0;34m>=[0m[0;36m4[0m[0;34m:[0m[0;34m[0m
[0;34m[0m                [0mprint[0m[0;34m([0m[0;34m'    align: reflected beam'[0m[0;34m)[0m[0;34m[0m
[0;34m[0m            [0mget_beamline[0m[0;34m([0m[0;34m)[0m[0;34m.[0m[0msetReflectedBeamROI[0m[0;34m([0m[0mtotal_angle[0m[0;34m=[0m[0mreflection_angle[0m[0;34m*[0m[0;36m2.0[0m[0;34m)[0m[0;34m[0m
[0;34m[0m            [0;31m#get_beamline().setReflectedBeamROI(total_angle=reflection_angle*2.0, size=[12,2])[0m[0;34m[0m
[0;34m[0m            [0;34m[0m
[0;34m[0m            [0mself[0m[0;34m.[0m[0mthabs[0m[0;34m([0m[0mreflection_angle[0m[0;34m)[0m[0;34m[0m
[0;34m[0m            [0;34m[0m
[0;34m[0m            [0mresult[0m [0;34m=[0m [0mfit_scan[0m[0;34m([0m[0msth[0m[0;34m,[0m [0;36m0.2[0m[0;34m,[0m [0;36m41[0m[0;34m,[0m [0mfit[0m[0;34m=[0m[0;34m'max'[0m[0;34m)[0m [0;34m[0m
[0;34m[0m            [0;31m#result = fit_scan(sth, 0.2, 81, fit='max') #it's useful for alignment of SmarAct stage[0m[0;34m[0m
[0;34m[0m            [0msth_target[0m [0;34m=[0m [0mresult[0m[0;34m.[0m[0mvalues[0m[0;34m[[0m[0;34m'x_max'[0m[0;34m][0m[0;34m-[0m[0mreflection_angle[0m[0;34m[0m
[0;34m[0m            [0;34m[0m
[0;34m[0m            [0;32mif[0m [0mresult[0m[0;34m.[0m[0mvalues[0m[0;34m[[0m[0;34m'y_max'[0m[0;34m][0m[0;34m>[0m[0;36m50[0m[0;34m:[0m[0;34m[0m
[0;34m[0m                [0mth_target[0m [0;34m=[0m [0mself[0m[0;34m.[0m[0m_axes[0m[0;34m[[0m[0;34m'th'[0m[0;34m][0m[0;34m.[0m[0mmotor_to_cur[0m[0;34m([0m[0msth_target[0m[0;34m)[0m[0;34m[0m
[0;34m[0m                [0mself[0m[0;34m.[0m[0mthsetOrigin[0m[0;34m([0m[0mth_target[0m[0;34m)[0m[0;34m[0m
[0;34m[0m[0;34m[0m
[0;34m[0m            [0;31m#fit_scan(smy, 0.2, 21, fit='max')[0m[0;34m[0m
[0;34m[0m            [0mself[0m[0;34m.[0m[0msetOrigin[0m[0;34m([0m[0;34m[[0m[0;34m'y'[0m[0;34m][0m[0;34m)[0m            [0;34m[0m
[0;34m[0m[0;34m[0m
[0;34m[0m        [0;32mif[0m [0mstep[0m[0;34m<=[0m[0;36m10[0m[0;34m:[0m[0;34m[0m
[0;34m[0m            [0mself[0m[0;34m.[0m[0mthabs[0m[0;34m([0m[0;36m0.0[0m[0;34m)[0m[0;34m[0m
[0;34m[0m            [0mbeam[0m[0;34m.[0m[0moff[0m[0;34m([0m[0;34m)[0m[0;34m[0m[0m
[0;31mFile:[0m      /opt/ipython_profiles/profile_collection/startup/94-sample.py
[0;31mType:[0m      method
